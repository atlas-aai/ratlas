---
title: "Report Writing"
output: 
  rmarkdown::html_vignette:
vignette: >
  %\VignetteIndexEntry{report-writing-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "figure/",
  fig.retina = 3,
  fig.width = 6,
  fig.asp = 0.618, 
  fig.align = "center",
  out.width = "90%"
)
```

```{r setup, include = FALSE}
library(ratlas)
library(here)
library(tidyverse)
library(kableExtra)
library(english)
library(knitr)
```

## Creating a New Project

When beginning a new report, the first step is to create a new project
in RStudio. This can be done by clicking: 
  
<center> **File > New Project > New Directory > New Project** </center>

From there, specify the project name and the directory where you would like to 
save the project for the new report. To lessen confusion later, it is usually 
worthwhile to save each report in its own directory so that you can quickly and 
easily find the report at a later date.

## Structuring the Project Directories

Once the project has been created, the next step is to create the file structure 
for the report. To do this, begin by typing `library(here)` into the RStudio 
Console. Note, you will need to install the here package if it is not already 
installed. The here package can be installed by typing `install.packages("here)`.

![Type RStudio Console Commands](figure/type-commands-console.png)



After the here package has been installed and loaded, four project directories 
will need to be created. These four directories are:

- R/
- data-raw/
- data/
- output/

To create the R directory, type the command `dir.create(here("R"))`. This will 
create the folder, and you should be able to see it in your file directory at 
the lower right corner of your RStudio screen. The same process can be used to 
create the remaining three directories. 

The R directory is used to store analysis scripts.

The data-raw directory is used to store raw data files.

The data directory is used to store cleaned or intermediate files.

The output directory is used to store final output files that can be read into 
the report.

## Writing the Setup Chunk

The Setup Chunk is where you set all of the default settings for your report. 
In doing this, you want to create the Setup Chunk so that all of the necessary 
settings can be set in a reproducible way. In other words, you want the code to 
be able to run on any computer, not just yours.

The first step in doing this is to load the needed packages. Bear in mind that 
not all computers will have the the necessary packages installed already. Thus, 
the code in the Setup Chunk needs to test whether these are already installed, 
install them if they are not already installed, and then load the packages. 

This can be done by running the following code:

```{r package_install_loading, echo = TRUE, eval = FALSE}
needed_packages <- c("ratlas", "tidyverse", "english", "kableExtra")
load_packages <- function(x) {
  if (!(x %in% installed.packages())) {
    install.packages(x)
  }
  suppressPackageStartupMessages(require(x, character.only = TRUE))
}
vapply(needed_packages, load_packages, logical(1))

system <- ifelse(Sys.info()["sysname"] == "Darwin", "Mac", "Windows")

extrafont::loadfonts(quiet = TRUE)
```

Additionally, the theme for ggplot should be specified. This can be done with 
the following code.

```{r set_ggplot_theme, echo = TRUE, eval = FALSE}

```

Together, your first chunk of the file should look like:

```{r setup_chunk, echo = TRUE, eval = FALSE}
needed_packages <- c("ratlas", "tidyverse", "english", "kableExtra")
load_packages <- function(x) {
  if (!(x %in% installed.packages())) {
    install.packages(x)
  }
  suppressPackageStartupMessages(require(x, character.only = TRUE))
}
vapply(needed_packages, load_packages, logical(1))

system <- ifelse(Sys.info()["sysname"] == "Darwin", "Mac", "Windows")

extrafont::loadfonts(quiet = TRUE)

```

For simplicity, this setup code chunk can just be copy and pasted into the 
rmarkdown file to write the report. 

## Create and Cross Reference Tables

Tables can be created using the kable function in the kableExtra package in R. 

Creating tables is relatively simple. The kable package takes an existing 
dataset and places the vectors (i.e., columns in the data frame) into columns in
the table. 

As an example, take the *iris* dataset that is automatically loaded in R. To 
make a more reasonably sized table for this example, let's filter the dataset to
flowers with petal length greater than 6.0 with the following code:

```{r filtered_iris, echo = TRUE, eval = TRUE}
temp <- iris %>%
  filter(Petal.Length > 6.0) %>%
  arrange(desc(Petal.Length))

temp
```

Do note, that this example uses the tidyverse package in filtering the data.

Now that the data is more manageable, the smaller dataset can be turned into a 
table. The full kable function help page can be found by using the `?kable` 
command. The full details for the kable function parameters can be found here. 

Briefly, *x* holds the data frame, *digits* indicates the number of digits 
displayed to the right of the decimal point, *col.names* indicates what each 
column should be named, *align* specifies how to align the data within each 
column, *caption* specifies the title for the table, *booktabs* specifies 
formatting for the table (i.e., the bolded column headers, the horizontal lines,
the subtle horizontal lines between each row), and *format.args* specifies 
format arguments to be used in the table. In this instance, *big.mark = ","* 
specifies that commas should be inserted to the left of the decimal point when 
necessary to improve readability (i.e., printing 3,400 instead of 3400).

```{r iris, echo = TRUE}
kable(x = temp, digits = 1, col.names = c("Sepal Length", "Sepal Width", 
                                          "Petal Length", "Petal Width", 
                                          "Species"), 
      align = "c", caption = "A table of irises with long petals", 
      booktabs = TRUE, format.args = list(big.mark = ","))
```

Tables may be referenced using the following inline command: 
`\@ref(tab:chunk-label)`. Please note, however, that the text to the right of 
the colon refers to the code chunk name. Of special importance, cross-references
cannot use an underscore in the name of the code chunk. The underscore is a 
special character in Latex, which causes difficulties in referencing table code 
chunks using an underscore in the name.

In completing this example, we can then reference the numbered table using 
`\@ref(tab:iris)`, and a hyperlink will appear with the number of the table. The 
hyperlink can be clicked to direct the user to the location of the table in the 
document.

## Create and Cross Reference Figures

## Using Inline R Code 

## Combining Words

## Turning Numbers Into Words

