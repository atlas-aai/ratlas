---
title: "Plotting in ratlas"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Plotting in ratlas}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, child="children/chunk-options.txt"}
```

```{r setup, include = FALSE}
library(ratlas)
library(dplyr)
library(ggplot2)
library(viridisLite)

library(systemfonts)
require_font("Archivo Narrow", fallback = "sans")

knitr::opts_chunk$set(dev = "ragg_png")
```

This vignette walks through how to create consistent graphics that meet ATLAS formatting standards using {ggplot2}.
The ggplot2 package uses the grammar of graphics to create elegant and reproducible plots that are publication ready.
The ratlas package provides an extension to ggplot2 by customizing the default theme to match brand requirements.

## Introduction to ggplot2

A full tutorial of how to use ggplot2 is beyond the scope of this vignette.
If you are new to ggplot2, we recommend you start with these resources:

* [Data Visualisation](https://r4ds.hadley.nz/data-visualize.html) in *R for Data Science*, by Hadley Wickham, Mine Çetinkaya-Rundel, & Garrett Grolemund
* [*Data Visualization*](https://socviz.co/), by Kieran Healy
* [*R Graphics Cookbook*](https://r-graphics.org), by Winston Chang

These resources walk provide an overview of ggplot2 and provide examples with code for creating different types of plots.
For a more in depth description of how ggplot2 works, we recommend [*ggplot2: Elegant Graphics for Data Analysis*](https://ggplot2-book.org), by Hadley Wickham.

To demonstrate how to use the ATLAS theme for ggplot2, we will use the following example plot of the `penguins` data set.

```{r}
#| label: init-plot

library(ggplot2)

p1 <- ggplot(penguins, aes(x = bill_len, y = flipper_len)) +
  geom_point(aes(color = species), na.rm = TRUE)

p1
```


## Using `theme_atlas()`

The ATLAS ggplot2 theme can be applied by adding a `ratlas::theme_atlas()` layer to plot, just as you would add any other theme.

```{r}
#| label: theme-atlas-ex

library(ratlas)

p1 +
  theme_atlas()
```

There are a few points to draw attention to when comparing the ATLAS theme to the ggplot2 default.
First, the gray  background has been removed, and the grid lines have been changed from white to gray.
Second, the legend has been moved from a vertical orientation on the right-hand side of the plot to a horizontal orientation below the plot.
Finally, the font has been changed to Archivo Narrow, which is freely available from [Google Fonts](https://fonts.google.com/specimen/Archivo+Narrow).

## Changing the font

Although Archivo Narrow provides a modern font that works in most cases, it is often desirable to have a font that matches the brand requirements.
For fonts that are available on most systems, the University of Kansas and ATLAS recommend [Arial and Palatino](https://brand.ku.edu/guidelines/design/typography#section4196).
These fonts can be loaded using the {systemfonts} package.

```{r showtxtfnt}
library(systemfonts)
require_font("Arial")
require_font("Palatino")
```

Once the fonts has been loaded, you can apply them to the ATLAS theme using the `base_family` argument.

```{r}
#| label: palatino-font

p1 +
  theme_atlas(base_family = "Palatino")
```

## Using color-blind-safe palettes

For discrete color scales, the ratlas package includes the Okabe Ito color palette developed by [Masataka Okabe and Kei Ito](https://jfly.uni-koeln.de/color/).
This can be used with the `ratlas::scale_color_okabeito()` function.

```{r}
#| label: okabeito-compare
#| out-width: "40%"
#| fig-asp: 1.618
#| fig-show: "hold"

ggplot(mtcars, aes(x = mpg, y = disp)) +
  geom_point(aes(color = factor(cyl)), size = 3) +
  theme_atlas()

ggplot(mtcars, aes(x = mpg, y = disp)) +
  geom_point(aes(color = factor(cyl)), size = 3) +
  scale_color_okabeito() +
  theme_atlas()
```

For continuous color scales, the viridis family of color palettes should be used.
These palettes were created by [Stéfan van der Walt](https://github.com/stefanv) and [Nathaniel Smith](https://github.com/njsmith).

```{r}
#| label: viridis-printing
#| include: false

n_col <- 128
img <- function(obj, nam) {
  image(1:length(obj), 1, as.matrix(1:length(obj)), col = obj, main = nam,
        ylab = "", xaxt = "n", yaxt = "n",  bty = "n")
}
```

```{r}
#| label: show-viridis
#| echo: FALSE
#| fig-asp: 0.6

oldpar <- par(mfrow=c(8, 1), mar=rep(1, 4))
img(rev(viridis(n_col)), "Viridis")
img(rev(magma(n_col)), "Magma")
img(rev(inferno(n_col)), "Inferno")
img(rev(plasma(n_col)), "Plasma")
img(rev(cividis(n_col)), "Cividis")
img(rev(rocket(n_col)), "Rocket")
img(rev(mako(n_col)), "Mako")
img(rev(turbo(n_col)), "Turbo")
par(oldpar)
```

These color scales are perceptually uniform, perform well for a variety of colorblindness, and maintain the ability to discriminate across the perceptual spectrum when rendered or printed in gray scale.
These color scales can be applied using `ggplot2::scale_color_viridis_c()`.
There is also a discrete option for the viridis color palette (`ggplot2::scale_color_viridis_d()`); however, the Okabe Ito palette is preferred for discrete scales.

```{r}
#| label: viridis-compare
#| out-width: "47%"
#| fig-asp: 1.618
#| fig-show: "hold"

ggplot(faithfuld, aes(x = eruptions, y = waiting)) +
  geom_tile(aes(fill = density)) +
  theme_atlas()

ggplot(faithfuld, aes(x = eruptions, y = waiting)) +
  geom_tile(aes(fill = density)) +
  scale_fill_viridis_c() +
  theme_atlas()
```

## Setting a global theme

If you have several plots in a document, it can be a hassle to always remember to add `+ theme_atlas()` to every plot and to switch to a non-default color palette.
To make the formatting of plots easier, ratlas includes a wrapper function, `set_theme_ratlas()` which will change the ggplot2 defaults so that `theme_atlas()` is always used, and the default color scales are changed to the Okabe Ito palette for discrete scales and the viridis palette for continuous scales.
That is, once `set_theme_ratlas()` has been called, the `scale_color_okabeito()` and `theme_atlas()` lines no longer need to be added.
Instead, they are applied by default. 

```{r}
#| label: default-theme

set_theme_ratlas()

p1
```

`set_theme_ratlas()` also provides flexibility for which defaults are set.
For example, to use the Palatino font by default, use `set_theme_ratlas(font = "Palatino")`.
See `?set_theme_ratlas()` for all options.

## Saving plots

Finally, it is often useful to save plots to a file.
This can be done with `ggsave2()`, which is a wrapper around `ggplot2::ggsave()`.
The `ggsave2()` version applies some defaults to all ATLAS plots.
Specifically, the aspect ratio of plots is set to a reasonable default (rather than using the current size of your graphics device), and fonts are automatically embedded when saving to a PDF format, allowing the plots to render correctly on any system.

```{r eval = FALSE}
ggsave2(plot = p1, filename = "my-plot.png", path = "where/to/save")
```

The `ggsave2()` function also flips the order of the `filename` and `plot` arguments from the original `ggplot2::ggsave()` function.
This allows calls to the function to be chained together, making it easier to save the sample plot in multiple formats using the `|>` operator.

```{r eval = FALSE}
p1 |>
  ggsave2(filename = "my-plot.png", path = "where/to/save") |>
  ggsave2(filename = "my-plot.pdf", path = "where/to/save")
```
